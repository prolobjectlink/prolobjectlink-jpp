<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DatabaseClass.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prolobjectlink-jpp</a> &gt; <a href="index.source.html" class="el_package">org.prolobjectlink.db</a> &gt; <span class="el_source">DatabaseClass.java</span></div><h1>DatabaseClass.java</h1><pre class="source lang-java linenums">/*
 * #%L
 * prolobjectlink-jpp
 * %%
 * Copyright (C) 2019 Prolobjectlink Project
 * %%
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. Neither the name of the Prolobjectlink Project nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
 * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 * #L%
 */
package org.prolobjectlink.db;

import java.io.Serializable;
import java.lang.annotation.Annotation;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Comparator;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.objectweb.asm.ClassWriter;
import org.objectweb.asm.MethodVisitor;
import org.objectweb.asm.Opcodes;
import org.objectweb.asm.Type;
import org.objectweb.asm.util.CheckClassAdapter;
import org.prolobjectlink.db.util.JavaReflect;

public class DatabaseClass extends AbstractElement&lt;DatabaseClass&gt;
		implements Comparable&lt;DatabaseClass&gt;, Serializable, SchemaElement&lt;DatabaseClass&gt; {

	private boolean isView;
	protected String shortName;
	private boolean isAbstract;
	private String javaClassName;
	private transient Class&lt;?&gt; javaClass;
	protected transient DatabaseClass superClass;
	protected final List&lt;DatabaseClass&gt; superClasses;
	protected final Map&lt;String, DatabaseField&gt; fields;
	private transient DatabaseField primaryKeyField;
	private static final long serialVersionUID = -8770366199140961351L;
<span class="nc" id="L66">	public static final Map&lt;String, Integer&gt; versionMap = new HashMap&lt;String, Integer&gt;();</span>

	static {

<span class="nc" id="L70">		versionMap.put(&quot;1.1&quot;, Opcodes.V1_1);</span>
<span class="nc" id="L71">		versionMap.put(&quot;1.2&quot;, Opcodes.V1_2);</span>
<span class="nc" id="L72">		versionMap.put(&quot;1.3&quot;, Opcodes.V1_3);</span>
<span class="nc" id="L73">		versionMap.put(&quot;1.4&quot;, Opcodes.V1_4);</span>
<span class="nc" id="L74">		versionMap.put(&quot;1.5&quot;, Opcodes.V1_5);</span>
<span class="nc" id="L75">		versionMap.put(&quot;1.6&quot;, Opcodes.V1_6);</span>
<span class="nc" id="L76">		versionMap.put(&quot;1.7&quot;, Opcodes.V1_7);</span>
<span class="nc" id="L77">		versionMap.put(&quot;1.8&quot;, Opcodes.V1_8);</span>

<span class="nc" id="L79">	}</span>

	protected DatabaseField newField(String name, String comment, int position, Class&lt;?&gt; type) {
<span class="nc" id="L82">		return new DatabaseField(name, comment, position, type, schema, this);</span>
	}

	public DatabaseClass(String name, String comment, Schema schema) {
<span class="nc" id="L86">		this(name, comment, null, schema);</span>
<span class="nc" id="L87">	}</span>

	public DatabaseClass(Class&lt;?&gt; javaClass, String comment, Schema schema) {
<span class="nc bnc" id="L90" title="All 2 branches missed.">		this(javaClass != null ? javaClass.getName() : &quot;&quot;, comment, javaClass, schema);</span>
<span class="nc" id="L91">	}</span>

	public DatabaseClass(String name, String comment, Class&lt;?&gt; javaClass, Schema schema) {
<span class="nc" id="L94">		super(name, comment, schema);</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		if (name.contains(&quot;.&quot; + &quot;&quot;)) {</span>
<span class="nc" id="L96">			int index = name.lastIndexOf('.');</span>
<span class="nc" id="L97">			shortName = name.substring(index + 1);</span>
<span class="nc" id="L98">		} else {</span>
<span class="nc" id="L99">			shortName = name;</span>
		}
<span class="nc bnc" id="L101" title="All 2 branches missed.">		this.javaClassName = javaClass != null ? javaClass.getName() : &quot;&quot;;</span>
<span class="nc" id="L102">		this.fields = new HashMap&lt;String, DatabaseField&gt;();</span>
<span class="nc" id="L103">		this.superClasses = new ArrayList&lt;DatabaseClass&gt;();</span>
<span class="nc" id="L104">		this.javaClass = javaClass;</span>
<span class="nc" id="L105">		this.schema = schema;</span>
<span class="nc" id="L106">	}</span>

	public String generate() {
<span class="nc" id="L109">		StringBuilder buffer = new StringBuilder();</span>
<span class="nc" id="L110">		buffer.append(Modifier.PUBLIC);</span>
<span class="nc" id="L111">		buffer.append(' ');</span>
<span class="nc" id="L112">		buffer.append(&quot;class&quot;);</span>
<span class="nc" id="L113">		buffer.append(' ');</span>
<span class="nc" id="L114">		buffer.append(shortName);</span>
<span class="nc" id="L115">		buffer.append(' ');</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (superClass != null) {</span>
<span class="nc" id="L117">			buffer.append(&quot;extends&quot;);</span>
<span class="nc" id="L118">			buffer.append(' ');</span>
<span class="nc" id="L119">			buffer.append(superClass);</span>
		}
<span class="nc" id="L121">		Iterator&lt;DatabaseClass&gt; i = superClasses.iterator();</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (i.hasNext()) {</span>
<span class="nc" id="L123">			buffer.append(&quot;implements&quot;);</span>
<span class="nc" id="L124">			buffer.append(' ');</span>
		}
<span class="nc bnc" id="L126" title="All 2 branches missed.">		while (i.hasNext()) {</span>
<span class="nc" id="L127">			DatabaseClass clazz = i.next();</span>
<span class="nc" id="L128">			buffer.append(clazz);</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">			if (i.hasNext()) {</span>
<span class="nc" id="L130">				buffer.append(',');</span>
<span class="nc" id="L131">				buffer.append(' ');</span>
			}
<span class="nc" id="L133">		}</span>
<span class="nc" id="L134">		buffer.append(' ');</span>
<span class="nc" id="L135">		buffer.append('{');</span>
<span class="nc" id="L136">		buffer.append('\n');</span>
<span class="nc" id="L137">		buffer.append('\n');</span>

		// fields
<span class="nc" id="L140">		DatabaseField[] e = new DatabaseField[0];</span>
<span class="nc" id="L141">		DatabaseField[] a = fields.values().toArray(e);</span>
<span class="nc" id="L142">		Arrays.sort(a, new FieldComparator());</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		for (DatabaseField field : a) {</span>
<span class="nc" id="L144">			field.generateField(buffer);</span>
		}
<span class="nc" id="L146">		buffer.append('\n');</span>

		// empty constructor
<span class="nc" id="L149">		buffer.append('\t');</span>
<span class="nc" id="L150">		buffer.append(Modifier.PUBLIC);</span>
<span class="nc" id="L151">		buffer.append(' ');</span>
<span class="nc" id="L152">		buffer.append(shortName);</span>
<span class="nc" id="L153">		buffer.append(&quot;()&quot;);</span>
<span class="nc" id="L154">		buffer.append('{');</span>
<span class="nc" id="L155">		buffer.append('\n');</span>
<span class="nc" id="L156">		buffer.append('\t');</span>
<span class="nc" id="L157">		buffer.append('\t');</span>
<span class="nc" id="L158">		buffer.append('\n');</span>
<span class="nc" id="L159">		buffer.append('\t');</span>
<span class="nc" id="L160">		buffer.append('}');</span>
<span class="nc" id="L161">		buffer.append('\n');</span>
<span class="nc" id="L162">		buffer.append('\n');</span>

		// full constructor
<span class="nc" id="L165">		buffer.append('\t');</span>
<span class="nc" id="L166">		buffer.append(Modifier.PUBLIC);</span>
<span class="nc" id="L167">		buffer.append(' ');</span>
<span class="nc" id="L168">		buffer.append(shortName);</span>
<span class="nc" id="L169">		buffer.append('(');</span>

		// TODO respect declaration order resolve this doing field a persistent linked
		// hash map

<span class="nc" id="L174">		Iterator&lt;DatabaseField&gt; j = fields.values().iterator();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">		while (j.hasNext()) {</span>
<span class="nc" id="L176">			DatabaseField field = j.next();</span>
<span class="nc" id="L177">			field.generateParameter(buffer);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">			if (j.hasNext()) {</span>
<span class="nc" id="L179">				buffer.append(',');</span>
<span class="nc" id="L180">				buffer.append(' ');</span>
			}
<span class="nc" id="L182">		}</span>
<span class="nc" id="L183">		buffer.append(')');</span>
<span class="nc" id="L184">		buffer.append('{');</span>
<span class="nc" id="L185">		buffer.append('\n');</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">		for (DatabaseField field : a) {</span>
<span class="nc" id="L187">			field.generateAssigment(buffer);</span>
		}
<span class="nc" id="L189">		buffer.append('\t');</span>
<span class="nc" id="L190">		buffer.append('}');</span>
<span class="nc" id="L191">		buffer.append('\n');</span>
<span class="nc" id="L192">		buffer.append('\n');</span>

		// methods
<span class="nc bnc" id="L195" title="All 2 branches missed.">		for (DatabaseField field : fields.values()) {</span>
<span class="nc" id="L196">			field.generateGetter(buffer);</span>
<span class="nc" id="L197">			field.generateSetter(buffer);</span>
<span class="nc" id="L198">		}</span>
<span class="nc" id="L199">		buffer.append('}');</span>
<span class="nc" id="L200">		buffer.append('\n');</span>
<span class="nc" id="L201">		return &quot;&quot; + buffer + &quot;&quot;;</span>
	}

	public byte[] compile() {
<span class="nc" id="L205">		ClassWriter cw = new ClassWriter(Opcodes.ASM4);</span>
<span class="nc" id="L206">		String internalName = name.replace('.', '/');</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">		String superclass = superClass != null ? //</span>
<span class="nc" id="L208">				superClass.getName().replace('.', '/') : //</span>
<span class="nc" id="L209">				Type.getInternalName(Object.class);</span>

<span class="nc" id="L211">		String[] interfaces = new String[superClasses.size()];</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">		for (int i = 0; i &lt; superClasses.size(); i++) {</span>
<span class="nc" id="L213">			interfaces[i] = superClasses.get(i).name.replace('.', '/');</span>
		}

<span class="nc" id="L216">		String javaVersion = System.getProperty(&quot;java.version&quot;);</span>
<span class="nc" id="L217">		javaVersion = javaVersion.substring(0, javaVersion.lastIndexOf('.'));</span>
<span class="nc" id="L218">		CheckClassAdapter ca = new CheckClassAdapter(cw);</span>
<span class="nc" id="L219">		ca.visit(versionMap.get(javaVersion), Opcodes.ACC_PUBLIC, internalName, null, superclass, interfaces);</span>

		// Fields Declaration
<span class="nc bnc" id="L222" title="All 2 branches missed.">		for (DatabaseField field : fields.values()) {</span>
<span class="nc" id="L223">			field.createField(cw);</span>
<span class="nc" id="L224">		}</span>

<span class="nc" id="L226">		MethodVisitor con = ca.visitMethod(Opcodes.ACC_PUBLIC, &quot;&lt;init&gt;&quot;, Type.getMethodDescriptor(Type.VOID_TYPE), null,</span>
				null);

<span class="nc" id="L229">		con.visitCode();</span>
<span class="nc" id="L230">		con.visitVarInsn(Opcodes.ALOAD, 0);</span>
<span class="nc" id="L231">		con.visitMethodInsn(Opcodes.INVOKESPECIAL, superclass, &quot;&lt;init&gt;&quot;, Type.getMethodDescriptor(Type.VOID_TYPE),</span>
				false);
<span class="nc" id="L233">		con.visitInsn(Opcodes.RETURN);</span>
<span class="nc" id="L234">		con.visitMaxs(1, 1);</span>
<span class="nc" id="L235">		con.visitEnd();</span>

		// Fields Getters and Setters
<span class="nc bnc" id="L238" title="All 2 branches missed.">		for (DatabaseField field : fields.values()) {</span>
<span class="nc" id="L239">			Class&lt;?&gt; type = field.getType();</span>
<span class="nc" id="L240">			String typeDescriptor = Type.getDescriptor(type);</span>
<span class="nc" id="L241">			field.createGetter(ca, internalName, typeDescriptor, type);</span>
<span class="nc" id="L242">			field.createSetter(ca, internalName, typeDescriptor, type);</span>
<span class="nc" id="L243">		}</span>

<span class="nc" id="L245">		ca.visitEnd();</span>

<span class="nc" id="L247">		return cw.toByteArray();</span>
	}

	public int compareTo(DatabaseClass o) {
<span class="nc" id="L251">		DatabaseClass thisClass = this;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		if (thisClass.countFields() &gt; o.countFields()) {</span>
<span class="nc" id="L253">			return (Math.abs(thisClass.countFields() - o.countFields()));</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">		} else if (thisClass.countFields() &lt; o.countFields()) {</span>
<span class="nc" id="L255">			return -1 * (Math.abs(thisClass.countFields() - o.countFields()));</span>
		}
<span class="nc" id="L257">		return name.compareTo(o.getName());</span>
	}

	public DatabaseClass setSchema(Schema schema) {
<span class="nc" id="L261">		this.schema = schema;</span>
<span class="nc" id="L262">		return this;</span>
	}

	public Object newInstance() {
<span class="nc" id="L266">		return JavaReflect.newInstance(javaClass);</span>
	}

	public Class&lt;?&gt; getJavaClass() {
<span class="nc" id="L270">		return javaClass;</span>
	}

	public void setJavaClass(Class&lt;?&gt; javaClass) {
<span class="nc bnc" id="L274" title="All 2 branches missed.">		this.javaClassName = javaClass != null ? javaClass.getName() : &quot;&quot;;</span>
<span class="nc" id="L275">		this.javaClass = javaClass;</span>
<span class="nc" id="L276">	}</span>

	public String getJavaClassName() {
<span class="nc" id="L279">		return javaClassName;</span>
	}

	public void setJavaClassName(String javaClassName) {
<span class="nc" id="L283">		this.javaClassName = javaClassName;</span>
<span class="nc" id="L284">	}</span>

	public boolean isView() {
<span class="nc" id="L287">		return isView;</span>
	}

	public DatabaseClass setView(boolean isView) {
<span class="nc" id="L291">		this.isView = isView;</span>
<span class="nc" id="L292">		return this;</span>
	}

	public boolean isAbstract() {
<span class="nc" id="L296">		return isAbstract;</span>
	}

	public DatabaseClass setAbstract(boolean isAbstract) {
<span class="nc" id="L300">		this.isAbstract = isAbstract;</span>
<span class="nc" id="L301">		return this;</span>
	}

	public DatabaseClass getSuperClass() {
<span class="nc" id="L305">		return superClass;</span>
	}

	public DatabaseClass setSuperClass(DatabaseClass sc) {
<span class="nc bnc" id="L309" title="All 2 branches missed.">		if (sc.equals(this)) {</span>
			// exception here
		}
<span class="nc" id="L312">		this.superClass = sc;</span>
<span class="nc" id="L313">		return this;</span>
	}

	public boolean hasSuperClasses() {
<span class="nc bnc" id="L317" title="All 4 branches missed.">		return superClass != null || !superClasses.isEmpty();</span>
	}

	public Collection&lt;String&gt; getSuperClassesNames() {
<span class="nc" id="L321">		List&lt;String&gt; supers = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L322">		supers.add(superClass.getName());</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">		for (DatabaseClass databaseClass : superClasses) {</span>
<span class="nc" id="L324">			supers.add(databaseClass.getName());</span>
<span class="nc" id="L325">		}</span>
<span class="nc" id="L326">		return supers;</span>
	}

	public Collection&lt;DatabaseClass&gt; getSuperClasses() {
<span class="nc" id="L330">		List&lt;DatabaseClass&gt; cs = new ArrayList&lt;DatabaseClass&gt;();</span>
<span class="nc" id="L331">		cs.add(superClass);</span>
<span class="nc" id="L332">		cs.addAll(superClasses);</span>
<span class="nc" id="L333">		return cs;</span>
	}

	public DatabaseClass addSuperClass(DatabaseClass superClass) {
<span class="nc" id="L337">		superClasses.add(superClass);</span>
<span class="nc" id="L338">		return this;</span>
	}

	public DatabaseClass removeSuperClass(DatabaseClass superClass) {
<span class="nc bnc" id="L342" title="All 2 branches missed.">		if (this.superClass.equals(superClass)) {</span>
<span class="nc" id="L343">			this.superClass = null;</span>
		}
<span class="nc" id="L345">		superClasses.remove(superClass);</span>
<span class="nc" id="L346">		return this;</span>
	}

	public boolean isSuperClassOf(DatabaseClass clazz) {
<span class="nc" id="L350">		Collection&lt;DatabaseClass&gt; supers = clazz.getSuperClasses();</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		for (DatabaseClass databaseClass : supers) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">			if (this.equals(databaseClass)) {</span>
<span class="nc" id="L353">				return true;</span>
			}
<span class="nc" id="L355">		}</span>
<span class="nc" id="L356">		return false;</span>
	}

	public boolean isSuperClassOf(String name) {
<span class="nc" id="L360">		DatabaseClass c = schema.getClass(name);</span>
<span class="nc bnc" id="L361" title="All 4 branches missed.">		return c != null &amp;&amp; c.isSubClassOf(this);</span>
	}

	public String getShortName() {
<span class="nc" id="L365">		return shortName;</span>
	}

	public DatabaseField getPrimaryKeyField() {
<span class="nc" id="L369">		return primaryKeyField;</span>
	}

	public void setPrimaryKeyField(DatabaseField primaryKeyField) {
<span class="nc" id="L373">		this.primaryKeyField = primaryKeyField;</span>
<span class="nc" id="L374">	}</span>

	public DatabaseClass setShortName(String shortName) {
<span class="nc" id="L377">		this.shortName = shortName;</span>
<span class="nc" id="L378">		return this;</span>
	}

	public Collection&lt;DatabaseField&gt; getFields() {
<span class="nc" id="L382">		return fields.values();</span>
	}

	public Map&lt;String, DatabaseField&gt; getFieldsMap() {
<span class="nc" id="L386">		return fields;</span>
	}

	public DatabaseField getField(String name) {
<span class="nc" id="L390">		return fields.get(name);</span>
	}

	public boolean hasField(String name) {
<span class="nc bnc" id="L394" title="All 2 branches missed.">		return getField(name) != null;</span>
	}

	/**
	 * Add a field with your respective type. The created field is not marked like
	 * primary key.
	 * 
	 * @param name field name
	 * @param type type of the field
	 * @return the field created and added to this class
	 * @since 1.0
	 */
	public DatabaseField addField(String name, String comment, int position, Class&lt;?&gt; type) {
<span class="nc" id="L407">		return addField(name, comment, position, type, false);</span>
	}

	/**
	 * Add a field with your respective type and marked like class's primary key.
	 * 
	 * @param name       field name
	 * @param type       type of the field
	 * @param primaryKey true if this field is marked like primary key
	 * @return the field created and added to this class
	 * @since 1.0
	 */
	public DatabaseField addField(String name, String comment, int position, Class&lt;?&gt; type, boolean primaryKey) {
<span class="nc" id="L420">		DatabaseField f = newField(name, comment, position, type);</span>
<span class="nc" id="L421">		f.setPrimaryKey(primaryKey);</span>
<span class="nc" id="L422">		fields.put(name, f);</span>
<span class="nc" id="L423">		return f;</span>
	}

	/**
	 * Add a field of type Collection/Map of given class type
	 * 
	 * @param name       field name
	 * @param type       type of the field
	 * @param linkedType Generic class for collection/Map
	 * @return the field created and added to this class
	 * @since 1.0
	 */
	public DatabaseField addField(String name, String comment, int position, Class&lt;?&gt; type, Class&lt;?&gt; linkedType) {
<span class="nc" id="L436">		DatabaseField f = newField(name, comment, position, type);</span>
<span class="nc" id="L437">		f.setLinkedType(linkedType);</span>
<span class="nc" id="L438">		fields.put(name, f);</span>
<span class="nc" id="L439">		return f;</span>
	}

	/**
	 * Add a field
	 * 
	 * @param field to be added
	 * @return the given field
	 * @since 1.0
	 */
	public DatabaseField addField(DatabaseField field) {
<span class="nc" id="L450">		fields.put(field.getName(), field);</span>
<span class="nc" id="L451">		return field;</span>
	}

	public DatabaseClass removeField(String name) {
<span class="nc" id="L455">		fields.remove(name);</span>
<span class="nc" id="L456">		return this;</span>
	}

	public int countFields() {
<span class="nc" id="L460">		return fields.size();</span>
	}

	public boolean isSubClassOf(String name) {
<span class="nc bnc" id="L464" title="All 4 branches missed.">		if (superClass != null &amp;&amp; superClass.getName().equals(name)) {</span>
<span class="nc" id="L465">			return true;</span>
		}
<span class="nc bnc" id="L467" title="All 2 branches missed.">		for (DatabaseClass c : superClasses) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">			if (c.getName().equals(name)) {</span>
<span class="nc" id="L469">				return true;</span>
			}
<span class="nc" id="L471">		}</span>
<span class="nc" id="L472">		return false;</span>
	}

	public boolean isSubClassOf(DatabaseClass clazz) {
<span class="nc" id="L476">		return isSubClassOf(clazz.getName());</span>
	}

	public Collection&lt;DatabaseClass&gt; getSubclasses() {
<span class="nc" id="L480">		Collection&lt;DatabaseClass&gt; sub = new ArrayList&lt;DatabaseClass&gt;();</span>
<span class="nc" id="L481">		Collection&lt;DatabaseClass&gt; all = schema.getClasses();</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">		for (DatabaseClass databaseClass : all) {</span>
<span class="nc" id="L483">			DatabaseClass sc = databaseClass.getSuperClass();</span>
<span class="nc bnc" id="L484" title="All 4 branches missed.">			if (sc != null &amp;&amp; sc.equals(this)) {</span>
<span class="nc" id="L485">				sub.add(databaseClass);</span>
			} else {
<span class="nc" id="L487">				Collection&lt;DatabaseClass&gt; s = databaseClass.getSuperClasses();</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">				for (DatabaseClass databaseClass2 : s) {</span>
<span class="nc" id="L489">					DatabaseClass sc2 = databaseClass.getSuperClass();</span>
<span class="nc bnc" id="L490" title="All 4 branches missed.">					if (sc2 != null &amp;&amp; sc2.getSuperClass().equals(this)) {</span>
<span class="nc" id="L491">						sub.add(databaseClass2);</span>
					}
<span class="nc" id="L493">				}</span>
			}
<span class="nc" id="L495">		}</span>
<span class="nc" id="L496">		return sub;</span>
	}

	@Override
	public String toString() {
<span class="nc" id="L501">		return getName();</span>
	}

	@Override
	public int hashCode() {
<span class="nc" id="L506">		final int prime = 31;</span>
<span class="nc" id="L507">		int result = 1;</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">		result = prime * result + ((fields == null) ? 0 : fields.hashCode());</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">		result = prime * result + ((name == null) ? 0 : name.hashCode());</span>
<span class="nc" id="L510">		return result;</span>
	}

	@Override
	public boolean equals(Object obj) {
<span class="nc bnc" id="L515" title="All 2 branches missed.">		if (this == obj)</span>
<span class="nc" id="L516">			return true;</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">		if (obj == null)</span>
<span class="nc" id="L518">			return false;</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">		if (getClass() != obj.getClass())</span>
<span class="nc" id="L520">			return false;</span>
<span class="nc" id="L521">		DatabaseClass other = (DatabaseClass) obj;</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">		if (fields == null) {</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">			if (other.fields != null)</span>
<span class="nc" id="L524">				return false;</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">		} else if (!fields.equals(other.fields)) {</span>
<span class="nc" id="L526">			return false;</span>
		}
<span class="nc bnc" id="L528" title="All 2 branches missed.">		if (name == null) {</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">			if (other.name != null)</span>
<span class="nc" id="L530">				return false;</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">		} else if (!name.equals(other.name)) {</span>
<span class="nc" id="L532">			return false;</span>
		}
<span class="nc" id="L534">		return true;</span>
	}

<span class="nc" id="L537">	public class FieldComparator implements Comparator&lt;DatabaseField&gt; {</span>

		public int compare(DatabaseField o1, DatabaseField o2) {
<span class="nc" id="L540">			return o1.compareTo(o2);</span>
		}
	}

	public DatabaseClass setComment(String comment) {
<span class="nc" id="L545">		this.comment = comment;</span>
<span class="nc" id="L546">		return this;</span>
	}

	public SchemaElementType geElementType() {
<span class="nc" id="L550">		return SchemaElementType.CLASS;</span>
	}

	/**
	 * Add a field of type Collection/Map of given class type
	 * 
	 * @param name        field name
	 * @param type        type of the field
	 * @param linkedClass Generic class for collection/Map
	 * @return the field created and added to this class
	 * @since 1.0
	 * @deprecated
	 */
	@Deprecated
	public DatabaseField addField(String name, String comment, int position, Class&lt;?&gt; type, DatabaseClass linkedClass) {
<span class="nc" id="L565">		DatabaseField f = newField(name, comment, position, type);</span>
<span class="nc" id="L566">		f.setLinkedClass(linkedClass);</span>
<span class="nc" id="L567">		fields.put(name, f);</span>
<span class="nc" id="L568">		return f;</span>
	}

	public boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass) {
<span class="nc" id="L572">		return getJavaClass().isAnnotationPresent(annotationClass);</span>
	}

	public DatabaseField getIdField() {
<span class="nc bnc" id="L576" title="All 2 branches missed.">		for (DatabaseField f : getFields()) {</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">			if (f.isPrimaryKey()) {</span>
<span class="nc" id="L578">				return f;</span>
			}
<span class="nc" id="L580">		}</span>
<span class="nc" id="L581">		return null;</span>
	}

	public DatabaseField getVersionField() {
<span class="nc bnc" id="L585" title="All 2 branches missed.">		for (DatabaseField f : getFields()) {</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">			if (f.isVersion()) {</span>
<span class="nc" id="L587">				return f;</span>
			}
<span class="nc" id="L589">		}</span>
<span class="nc" id="L590">		return null;</span>
	}

	public boolean hasVersionField() {
<span class="nc bnc" id="L594" title="All 2 branches missed.">		for (DatabaseField f : getFields()) {</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">			if (f.isVersion()) {</span>
<span class="nc" id="L596">				return true;</span>
			}
<span class="nc" id="L598">		}</span>
<span class="nc" id="L599">		return false;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>